<?xml version="1.0" encoding="utf-8"?>
<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Vanilla Furniture Expanded - Production</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAdd">
          <xpath>
            /Defs/RecipeDef[@Name="MakeCourage" or @Name="MakeCourageBulk"]/recipeUsers
          </xpath>
          <value>
            <li>VFE_TableDrugLabElectric</li>
          </value>
        </li>

        <li Class="PatchOperationAdd">
          <xpath>
            /Defs/ThingDef[@Name="Drug_Quixote"]/recipeMaker/recipeUsers
          </xpath>
          <value>
            <li>VFE_TableDrugLabElectric</li>
          </value>
        </li>

      </operations>
    </match>
  </Operation>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Combat Extended</li>
    </mods>
    <match Class="PatchOperationSequence">
      <success>Always</success>
      <operations>
        <li Class="PatchOperationAdd">
          <xpath>
            /Defs/ThingDef[defName="Drug_Quixote" or defName="Drug_Courage"]/statBases
          </xpath>
          <value>
            <Bulk>0.01</Bulk>
          </value>
        </li>

        <li Class="PatchOperationRemove">
          <xpath>
            /Defs/HediffDef[defName="CourageStarting" or defName="CourageEffective" or defName="QuixoteHigh"]
          </xpath>
        </li>
        
        <li Class="PatchOperationAdd">
          <xpath>
            /Defs
          </xpath>
          <value>
            <HediffDef>
              <defName>QuixoteHigh</defName>
              <label>high on quixote</label>
              <labelNoun>a quixote high</labelNoun>
              <description>Quixote in the bloodstream. Increases combat related capabilities to height unheard-of.</description>
              <hediffClass>Hediff_High</hediffClass>
              <defaultLabelColor>(1,0,0.5)</defaultLabelColor>
              <scenarioCanAdd>true</scenarioCanAdd>
              <maxSeverity>1.0</maxSeverity>
              <isBad>false</isBad>
              <comps>
                <li Class="HediffCompProperties_SeverityPerDay">
                  <severityPerDay>-2</severityPerDay>
                  <showHoursToRecover>true</showHoursToRecover>
                </li>
              </comps>
              <stages>
                <li>
                  <minSeverity>0.0</minSeverity>
                  <label>after-effect kicking in</label>
                  <hediffGivers>
                    <li Class="HediffGiver_Random">
                      <hediff>quixoteAftereffect</hediff>
                      <mtbDays>0.0001</mtbDays>
                    </li>
                  </hediffGivers>
                </li>
                <li>
                  <minSeverity>0.01</minSeverity>
                  <label>after-effect imminent</label>
                  <statOffsets>
                    <Suppressability>-0.5</Suppressability>
                    <WorkSpeedGlobal>-0.25</WorkSpeedGlobal>
                    <ShootingAccuracyPawn>0.2</ShootingAccuracyPawn>
                  </statOffsets>
                  <totalBleedFactor>0.7</totalBleedFactor>
                  <painFactor>0</painFactor>
                  <restFallFactor>0</restFallFactor>
                  <hungerRateFactorOffset>1</hungerRateFactorOffset>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.2</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.5</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.2</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.15</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.10</offset>
                    </li>
                  </capMods>

                </li>
                <li>
                  <minSeverity>0.1</minSeverity>
                  <label>fading</label>
                  <statOffsets>
                    <Suppressability>-0.5</Suppressability>
                    <WorkSpeedGlobal>-0.25</WorkSpeedGlobal>
                    <ShootingAccuracyPawn>0.2</ShootingAccuracyPawn>
                  </statOffsets>
                  <totalBleedFactor>0.7</totalBleedFactor>
                  <painFactor>0</painFactor>
                  <restFallFactor>0</restFallFactor>
                  <hungerRateFactorOffset>1</hungerRateFactorOffset>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.2</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.5</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.2</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.15</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.10</offset>
                    </li>
                  </capMods>
                </li>


                <li>
                  <minSeverity>0.3</minSeverity>
                  <label>in effect</label>

                  <statOffsets>
                    <Suppressability>-1</Suppressability>
                    <WorkSpeedGlobal>-0.5</WorkSpeedGlobal>
                    <ShootingAccuracyPawn>0.5</ShootingAccuracyPawn>
                    <ReloadSpeed>0.2</ReloadSpeed>
                    <MeleeDodgeChance>0.5</MeleeDodgeChance>
                    <MeleeCritChance>0.5</MeleeCritChance>
                    <MeleeParryChance>0.15</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0</painFactor>
                  <restFallFactor>0</restFallFactor>
                  <totalBleedFactor>0.5</totalBleedFactor>
                  <hungerRateFactorOffset>1</hungerRateFactorOffset>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.5</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>1</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.5</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.5</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.3</offset>
                    </li>
                  </capMods>
                </li>
              </stages>
            </HediffDef>

            <HediffDef>
              <defName>CourageStarting</defName>
              <label>courage taking effect</label>
              <description>Courage pills ingested and disintegrating in the stomach, it'll take a hour for the drug to fully effective, due to the slow release agents in the pill.</description>
              <hediffClass>Hediff_High</hediffClass>
              <defaultLabelColor>(1,0,0.5)</defaultLabelColor>
              <scenarioCanAdd>true</scenarioCanAdd>
              <maxSeverity>1.0</maxSeverity>
              <isBad>false</isBad>
              <initialSeverity>1</initialSeverity>
              <comps>
                <li Class="HediffCompProperties_SeverityPerDay">
                  <severityPerDay>-24</severityPerDay>
                  <showHoursToRecover>true</showHoursToRecover>
                </li>
              </comps>
              <stages>
                <li>
                  <minSeverity>0.0</minSeverity>
                  <label>100%</label>
                  <statOffsets>
                    <Suppressability>-0.75</Suppressability>
                    <ShootingAccuracyPawn>0.35</ShootingAccuracyPawn>
                    <ReloadSpeed>0.1</ReloadSpeed>
                    <MeleeDodgeChance>0.25</MeleeDodgeChance>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.1</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.05</painFactor>
                  <restFallFactor>0.5</restFallFactor>
                  <totalBleedFactor>0.75</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.35</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.6</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.2</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.25</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.20</offset>
                    </li>
                  </capMods>
                  <hediffGivers>
                    <li Class="HediffGiver_Random">
                      <hediff>CourageEffective</hediff>
                      <mtbDays>0.0001</mtbDays>
                    </li>
                  </hediffGivers>
                </li>
                <li>
                  <minSeverity>0.1</minSeverity>
                  <label>90%</label>
                  <statOffsets>
                    <Suppressability>-0.75</Suppressability>
                    <ShootingAccuracyPawn>0.35</ShootingAccuracyPawn>
                    <ReloadSpeed>0.1</ReloadSpeed>
                    <MeleeDodgeChance>0.25</MeleeDodgeChance>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.1</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.05</painFactor>
                  <restFallFactor>0.5</restFallFactor>
                  <totalBleedFactor>0.75</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.35</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.6</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.2</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.25</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.20</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.3</minSeverity>
                  <label>80%</label>
                  <statOffsets>
                    <Suppressability>-0.65</Suppressability>
                    <ShootingAccuracyPawn>0.3</ShootingAccuracyPawn>
                    <ReloadSpeed>0.1</ReloadSpeed>
                    <MeleeDodgeChance>0.2</MeleeDodgeChance>
                    <MeleeCritChance>0.2</MeleeCritChance>
                    <MeleeParryChance>0.1</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.1</painFactor>
                  <restFallFactor>0.6</restFallFactor>
                  <totalBleedFactor>0.8</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.28</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.48</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.16</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.2</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.16</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.5</minSeverity>
                  <label>50%</label>
                  <statOffsets>
                    <Suppressability>-0.5</Suppressability>
                    <ShootingAccuracyPawn>0.175</ShootingAccuracyPawn>
                    <ReloadSpeed>0.05</ReloadSpeed>
                    <MeleeDodgeChance>0.125</MeleeDodgeChance>
                    <MeleeCritChance>0.125</MeleeCritChance>
                    <MeleeParryChance>0.05</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.5</painFactor>
                  <restFallFactor>0.75</restFallFactor>
                  <totalBleedFactor>0.875</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.175</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.3</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.1</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.125</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.1</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.7</minSeverity>
                  <label>20%</label>
                  <statOffsets>
                    <Suppressability>-0.95</Suppressability>
                    <ShootingAccuracyPawn>0.07</ShootingAccuracyPawn>
                    <ReloadSpeed>0.02</ReloadSpeed>
                    <MeleeDodgeChance>0.05</MeleeDodgeChance>
                    <MeleeCritChance>0.05</MeleeCritChance>
                    <MeleeParryChance>0.02</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.81</painFactor>
                  <restFallFactor>0.9</restFallFactor>
                  <totalBleedFactor>0.95</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.07</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.12</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.04</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.05</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.04</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.9</minSeverity>
                  <label>initial</label>
                </li>
              </stages>
            </HediffDef>

            <HediffDef>
              <defName>CourageEffective</defName>
              <label>courage in effect</label>
              <description>Courage in the bloodstream, boosting combat capabilities for roughly a day.</description>
              <hediffClass>Hediff_High</hediffClass>
              <defaultLabelColor>(1,0,0.5)</defaultLabelColor>
              <scenarioCanAdd>true</scenarioCanAdd>
              <maxSeverity>1.0</maxSeverity>
              <initialSeverity>1</initialSeverity>
              <isBad>false</isBad>
              <comps>
                <li Class="HediffCompProperties_SeverityPerDay">
                  <severityPerDay>-1</severityPerDay>
                  <showHoursToRecover>true</showHoursToRecover>
                </li>
              </comps>
              <stages>
                <li>
                  <minSeverity>0.0</minSeverity>
                  <label>after-effect kicking in</label>
                  <hediffGivers>
                    <li Class="HediffGiver_Random">
                      <hediff>courageAftereffect</hediff>
                      <mtbDays>0.0001</mtbDays>
                    </li>
                  </hediffGivers>
                </li>
                <li>
                  <minSeverity>0.01</minSeverity>
                  <label>after-effect imminent</label>
                  <statOffsets>
                    <Suppressability>-0.5</Suppressability>
                    <ShootingAccuracyPawn>0.15</ShootingAccuracyPawn>
                    <ReloadSpeed>0.05</ReloadSpeed>
                  </statOffsets>
                  <painFactor>0.1</painFactor>
                  <restFallFactor>0.75</restFallFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.2</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.3</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.1</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.15</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.1</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.1</minSeverity>
                  <label>fading</label>
                  <statOffsets>
                    <Suppressability>-0.5</Suppressability>
                    <ShootingAccuracyPawn>0.15</ShootingAccuracyPawn>
                    <ReloadSpeed>0.05</ReloadSpeed>
                  </statOffsets>
                  <painFactor>0.1</painFactor>
                  <restFallFactor>0.75</restFallFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.2</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.3</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.1</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.15</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.1</offset>
                    </li>
                  </capMods>
                </li>
                <li>
                  <minSeverity>0.3</minSeverity>
                  <label>in effect</label>
                  <statOffsets>
                    <Suppressability>-0.75</Suppressability>
                    <ShootingAccuracyPawn>0.35</ShootingAccuracyPawn>
                    <ReloadSpeed>0.1</ReloadSpeed>
                    <MeleeDodgeChance>0.25</MeleeDodgeChance>
                    <MeleeCritChance>0.25</MeleeCritChance>
                    <MeleeParryChance>0.1</MeleeParryChance>
                  </statOffsets>
                  <painFactor>0.05</painFactor>
                  <restFallFactor>0.5</restFallFactor>
                  <totalBleedFactor>0.75</totalBleedFactor>
                  <capMods>
                    <li>
                      <capacity>Consciousness</capacity>
                      <offset>0.35</offset>
                    </li>
                    <li>
                      <capacity>Sight</capacity>
                      <offset>0.6</offset>
                    </li>
                    <li>
                      <capacity>Moving</capacity>
                      <postFactor>1.2</postFactor>
                    </li>
                    <li>
                      <capacity>BloodPumping</capacity>
                      <offset>0.25</offset>
                    </li>
                    <li>
                      <capacity>Breathing</capacity>
                      <offset>0.20</offset>
                    </li>
                  </capMods>
                </li>
              </stages>
            </HediffDef>
          </value>
        </li>
      </operations>
    </match>
  </Operation>


</Patch>